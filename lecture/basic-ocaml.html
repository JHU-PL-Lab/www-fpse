<!DOCTYPE HTML>
<!--
Solarize by TEMPLATED
templated.co @templatedco
Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
<head>
 <title>Functional Programming and Software Engineering</title>
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <meta name="description" content="" />
 <meta name="keywords" content="" />
 <!--[if lte IE 8]><script src="/pl/css/ie/html5shiv.js"></script><![endif]-->
 <script src="/fpse/js/jquery.min.js"></script>
 <script src="/fpse/js/jquery.dropotron.min.js"></script>
 <script src="/fpse/js/skel.min.js"></script>
 <script src="/fpse/js/skel-layers.min.js"></script>
 <script src="/fpse/js/init.js"></script>
 <noscript>
  <link rel="stylesheet" href="/fpse/css/skel.css" />
  <link rel="stylesheet" href="/fpse/css/style.css" />
 </noscript>
 <!--[if lte IE 8]><link rel="stylesheet" href="/fpse/css/ie/v8.css" /><![endif]-->
</head>
<body>

 <!-- Header Wrapper -->
  <div class="wrapper style1">
  
  <!-- Header -->
   <div id="header">
    <div class="container">
      
     <!-- Logo -->
      <h1><a href="/fpse/index.html" id="logo">FPSE</a></h1>
     
     <!-- Nav -->
      <nav id="nav">
       <ul>
          <li><a href="/fpse/logistics.html">Logistics</a></li>
          <li><a href="/fpse/dateline.html">Dateline</a></li> <!-- converted; don't edit .html edit .md -->
          <li><a href="/fpse/coding.html">Coding</a>
            <li><a href="">Assignments</a>
                <ul class="menu">
                <li><a href="/fpse/assignments/assignment1.html">Assignment 1</a></li>
                <li><a href="/fpse/assignments/assignment2.html">Assignment 2</a></li>
                <li><a href="/fpse/assignments/assignment3.html">Assignment 3</a></li>
                <li><a href="/fpse/assignments/assignment4.html">Assignment 4</a></li>
                <li><a href="/fpse/assignments/assignment5.html">Assignment 5</a></li>
                <li><a href="/fpse/assignments/assignment6.html">Assignment 6</a></li>
                <li><a href="/fpse/assignments/assignment7.html">Assignment 7</a></li>
                <li><a href="/fpse/assignments/project.html">Project</a></li>
              </ul></li>          <li><a href="https://courselore.org/courses/1192943254">Q&A</a></li>
          <li><a href="/fpse/contact.html">Contact Us</a></li>
      </ul>
</nav>
</div>
</div>


<!-- close-out code before the standard footer .. use to glue in raw html. -->
</div>
<!-- Main -->
<div id="main" class="wrapper style4">
<!-- Content -->
<div id="content" class="container">
<section>

<link rel="stylesheet" href="/fpse/css/friendly.css" />
<meta charset="utf-8" />
    <h2 id="introduction-to-ocaml">Introduction to OCaml</h2>

<p>(see the file <a href="basic-ocaml.ml">basic-ocaml.ml</a> if you want all of the ml examples in this file extracted out.  See <a href="basic-ocaml.md">basic-ocaml.md</a> for the Markdown which you can Preview in VSCode like I am doing in lecture)</p>
<h3 id="installing">Installing</h3>

<ul>
  <li>See <a href="https://pl.cs.jhu.edu/fpse/coding.html">the Coding page</a> for install instructions and lots of other information.</li>
  <li>Make sure to use the required version of OCaml, 5.3.0, install all the libraries listed via <code>opam</code>, and change your <code>.ocamlinit</code> file as mentioned on that page.
    <ul>
      <li>This will let us all “play in the same sandbox” and avoid confusion</li>
    </ul>
  </li>
</ul>

<h3 id="the-ecosystem-via-hello-world-in-ocaml">The Ecosystem via Hello World in OCaml</h3>

<ul>
  <li>Before getting into the details of the language we will cover the ecosystem at a high level</li>
</ul>

<h4 id="the-top-loop">The top loop</h4>

<ul>
  <li>Top loops allow you to type in small snippets of code which will run and produce a result.
    <ul>
      <li>e.g. shells like <code>bash</code>, Python’s <code>python3</code>, JavaScript <code>node</code>, etc.</li>
    </ul>
  </li>
  <li>The OCaml top loop is started with the shell command <code>utop</code>.</li>
  <li>We will run the OCaml top loop and show you you can enter expressions such as <code>3+4</code>, follow with <code>;;</code> to indicate end of input (<code>;;</code> is <strong>required</strong>), and hit return to get the result</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">utop</span> <span class="o">#</span> <span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">7</span>
</code></pre></div></div>

<ul>
  <li>Control-D will exit <code>utop</code>.</li>
</ul>

<h4 id="the-standalone-compiler">The Standalone Compiler</h4>

<ul>
  <li>The <code>ocamlc</code> compiler is the analogue of the  <code>cc</code>/<code>gcc</code>/<code>javac</code> compilers you have used
    <ul>
      <li>Compilers translate source code to a binary which you can then run from the shell.</li>
    </ul>
  </li>
  <li>In OCaml it is useful to live in <strong>both worlds</strong>: both play with code in a top loop, <em>and</em> use a compiler to compile it to a binary.</li>
  <li>Let’s cover how we will compile in OCaml.  Suppose the following is in a file <code>helloworld.ml</code>:
    <div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">open</span> <span class="nc">Core</span><span class="p">;;</span> <span class="c">(* Make the Core libraries directly available *)</span>
<span class="k">let</span> <span class="n">hw</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="o">^</span> <span class="s2">"world"</span><span class="p">;;</span>
<span class="n">printf</span> <span class="s2">"the string is %s</span><span class="se">\n</span><span class="s2">"</span> <span class="n">hw</span>
</code></pre></div>    </div>
  </li>
  <li>(The actual compiler is <code>ocamlc</code> or <code>ocamlopt</code>, but we will never be directly invoking it)</li>
  <li>Instead we will operate at a higher level and use build tool <code>dune</code> to invoke the compiler</li>
  <li><code>dune</code> is a modern <code>make</code>/<code>Makefile</code> equivalent for OCaml which is very powerful.</li>
  <li>So, in same directory, there should be a <code>dune</code> file with the following contents:
    <div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">executable</span>             <span class="c1">; create an executable</span>
<span class="p">(</span><span class="nf">name</span> <span class="nv">helloworld</span><span class="p">)</span>     <span class="c1">; need to give it a name</span>
<span class="p">(</span><span class="nf">modules</span> <span class="nv">helloworld</span><span class="p">)</span>  <span class="c1">; it consists of just one module, helloworld.ml</span>
<span class="p">(</span><span class="nf">libraries</span> <span class="nv">core</span><span class="p">)</span>      <span class="c1">; indicates that the core libraries are used</span>
<span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>This is the <strong>build file</strong>, specifying how to compile/test/run the program.  The notation is S-expressions.</li>
  <li>Also a file <code>dune-project</code> is needed with only <code>(lang dune 3.19)</code> in it.</li>
  <li>Now, type <code>dune build</code> to compile this <code>helloworld.ml</code> code as an executable.</li>
  <li>All of the results are placed in a new <code>_build/</code> sub-directory</li>
  <li>Then, run with <code>dune exec ./helloworld.exe</code> - same as typing <code>_build/default/helloworld.exe</code></li>
  <li>We will be using <code>dune</code> to build libraries and binaries, and <code>utop</code> to play with them.</li>
  <li>If you want to try these commands yourself the above <code>helloworld.ml</code> and dune files are in <a href="helloworld.zip">this zip</a>, just unzip and the <code>dune</code> commands above should work from within the <code>helloworld</code> directory.</li>
</ul>

<h3 id="ocaml-language-basics-in-utop">OCaml Language Basics in <code>utop</code></h3>

<ul>
  <li>We will start with OCaml by running tiny examples in the top-loop, but for the first assignment you will be working in both worlds.</li>
</ul>

<h3 id="integers">Integers</h3>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;;</span> <span class="c">(* outputs `- : int = 7` -- the value is 7, int is the type, "-" means no name given *)</span>
<span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;;</span> <span class="c">(* outputs `val x : int = 7` - give the result value a name, via let. *)</span>
<span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;;</span> <span class="c">(* the above defines `x` so can use it subsequently *)</span>
<span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5</span> <span class="k">in</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;;</span> <span class="c">(* let .. in defines a local variable z *)</span>
<span class="c">(* z is not defined after the `in` is over: z + 1 ;; will give an error. *)</span>
</code></pre></div></div>

<h4 id="boolean-operations">Boolean operations</h4>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">true</span><span class="p">;;</span>
<span class="n">b</span> <span class="o">&amp;&amp;</span> <span class="bp">false</span><span class="p">;;</span>
<span class="bp">true</span> <span class="o">||</span> <span class="bp">false</span><span class="p">;;</span>
<span class="mi">1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;;</span> <span class="c">(* = not == for equality comparison; note = works on ints only in our OCaml setup *)</span>
<span class="mi">1</span> <span class="o">&lt;&gt;</span> <span class="mi">2</span><span class="p">;;</span>  <span class="c">(* &lt;&gt;, not !=, for not equal *)</span>
</code></pre></div></div>

<h4 id="other-basic-data--see-documentation-for-details">Other basic data – see documentation for details</h4>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">4</span><span class="o">.</span><span class="mi">5</span><span class="p">;;</span> <span class="c">(* floats *)</span>
<span class="mi">4</span><span class="o">.</span><span class="mi">5</span> <span class="o">+.</span> <span class="mi">4</span><span class="o">.</span><span class="mi">3</span><span class="p">;;</span> <span class="c">(* operations are +. etc not just + which is for ints only *)</span>
<span class="mi">30980314323422</span><span class="nc">L</span><span class="p">;;</span> <span class="c">(* 64-bit integers *)</span>
<span class="k">'</span><span class="n">c'</span><span class="p">;;</span> <span class="c">(* characters *)</span>
<span class="s2">"and of course strings"</span><span class="p">;;</span>
</code></pre></div></div>

<h4 id="simple-functions-on-integers">Simple functions on integers</h4>

<p>Let’s declare a function <code>squared</code> with <code>x</code> as its one parameter.  <code>return</code> is  implicit.</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">squared</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;;</span> <span class="c">(* outputs `val squared : int -&gt; int = &lt;fun&gt;` *)</span>
<span class="n">squared</span> <span class="mi">4</span><span class="p">;;</span> <span class="c">(* to call a function -- separate arguments with S P A C E S - ! *)</span>
</code></pre></div></div>
<ul>
  <li>OCaml has no <code>return</code> statement; value of the whole body-expression is what gets returned</li>
  <li>Type is automatically <strong>inferred</strong> and printed as <code>domain -&gt; range</code>; <code>int -&gt; int</code> here.</li>
  <li>OCaml functions in fact always take only one argument - !  multiple arguments can be encoded (covered later)</li>
</ul>

<h4 id="fibonacci-series-example---0-1-1-2-3-5-8-13-">Fibonacci series example - <code>0 1 1 2 3 5 8 13 ...</code></h4>

<p>Let’s write a well-known function with recursion and if-then-else syntax</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="k">rec</span> <span class="n">fib</span> <span class="n">n</span> <span class="o">=</span> <span class="c">(* the "rec" keyword needs to be added to allow recursion *)</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span>
  <span class="k">else</span> <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">then</span> <span class="mi">1</span>
  <span class="k">else</span> <span class="n">fib</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);;</span> <span class="c">(* notice again everything is an expression, no "return" *)</span>

<span class="n">fib</span> <span class="mi">10</span><span class="p">;;</span> <span class="c">(* get the 10th Fibonacci number; 2^10 steps so don't make input too big! *)</span>
</code></pre></div></div>

<p>Nested conditionals as above are generally avoided in OCaml since they are not very readable.  For example here is an easier to read <code>fib</code> using pattern <code>match</code> notation similar to Java/C <code>switch</code> (we will cover <code>match</code> in detail later):</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="k">rec</span> <span class="n">fib</span> <span class="n">x</span> <span class="o">=</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span>
  <span class="o">|</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">0</span> 
  <span class="o">|</span> <span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">1</span> 
  <span class="o">|</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">fib</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);;</span>
</code></pre></div></div>
<h4 id="anonymous-aka-un-named-functions">Anonymous (aka un-named) functions</h4>

<ul>
  <li>Key feature of FP: functions are just expressions; put them in variables, pass and return from other functions, etc.</li>
  <li>Much of this course will be showing how this is useful</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">add1</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;;</span> <span class="c">(* the normal way to define an add1 function in OCaml *)</span>
<span class="n">add1</span> <span class="mi">3</span><span class="p">;;</span>
<span class="k">let</span> <span class="n">anon_add1</span> <span class="o">=</span> <span class="p">(</span><span class="k">function</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);;</span> <span class="c">(* equivalent to above; "x" is argument here *)</span>
<span class="k">let</span> <span class="n">anon_add1</span> <span class="o">=</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);;</span>      <span class="c">(* shorthand notation -- cut off the "ction" *)</span>
<span class="n">anon_add1</span> <span class="mi">3</span><span class="p">;;</span>
<span class="p">(</span><span class="n">anon_add1</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;;</span> 
<span class="p">((</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;;</span> <span class="c">(* can also inline an anonymous function definition *)</span>
</code></pre></div></div>

<ul>
  <li>Multiple arguments - just leave s p a c e s between multiple arguments in both definitions and uses</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">add</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;;</span>
<span class="n">add</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">;;</span>
<span class="p">(</span><span class="n">add</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">4</span><span class="p">;;</span> <span class="c">(* same meaning as previous application -- two applications, " " associates LEFT *)</span>
<span class="k">let</span> <span class="n">add3</span> <span class="o">=</span> <span class="n">add</span> <span class="mi">3</span><span class="p">;;</span> <span class="c">(* No need to give all arguments at once - !  
                      Type of add is int -&gt; (int -&gt; int) - "CURRIED" *)</span>
<span class="n">add3</span> <span class="mi">4</span><span class="p">;;</span>
<span class="n">add3</span> <span class="mi">20</span><span class="p">;;</span>
<span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">;;</span> <span class="c">(* Putting () around any infix operator turns it into a 2-argument function *)</span>
</code></pre></div></div>

<ul>
  <li>Conclusion: add is a function taking an integer, and returning a <strong>function</strong> which takes ints to ints.</li>
  <li>So, add is a <strong>higher-order function</strong>: it returns a function as result.</li>
  <li>Other forms of higher-order function take functions as arguments (e.g. the math compose example <code>o</code>)</li>
</ul>

<p>Observe <code>int -&gt; int -&gt; int</code> is parenthesized as <code>int -&gt; (int -&gt; int)</code> – <strong>right</strong> associativity which is opposite of arithmetic operators</p>

<p>Be careful on operator precedence with this goofy (aka stupid) way that function application doesn’t need parens!</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add3</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);;</span>
<span class="n">add3</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;;</span> <span class="c">(* NOT the previous - this is the same as (add3 3) * 2 - application binds tighter than * *)</span>
<span class="n">add3</span> <span class="o">@@</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;;</span> <span class="c">(* LIKE the original - @@ is like the " " for application but binds LOOSER than other ops *)</span>
</code></pre></div></div>

<ul>
  <li><code>=</code> is also a 2-argument function; it is somewhat strange in our <code>Core</code> OCaml on non-ints:
    <div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">3</span><span class="o">.</span><span class="mi">4</span> <span class="o">=</span> <span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="p">;;</span> <span class="c">(* errors, = only works on ints with the Core library in use *)</span>
<span class="nn">Float</span><span class="p">.(</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span> <span class="o">=</span> <span class="mi">4</span><span class="o">.</span><span class="mi">4</span><span class="p">);;</span> <span class="c">(* Solution: use the Float module's = function for floats *)</span>
</code></pre></div>    </div>
  </li>
  <li>Why this apparent ugliness?  Pay a price here but reap rewards later of never having the wrong notion of <code>=</code>.</li>
</ul>

<h3 id="simple-structured-data-types-option-and-result">Simple Structured Data Types: Option and Result</h3>

<ul>
  <li>Before getting into “bigger” data types like lists and trees, let’s use one of the simplest structured data types, the built-in <code>option</code> type.</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Some</span> <span class="mi">5</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="mi">5</span>
</code></pre></div></div>

<ul>
  <li>All this does is “wrap” the 5 in the <code>Some</code> tag</li>
  <li>Observe the type is <code>int option</code>, it is “optionally an integer”.</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">None</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="k">'</span><span class="n">a</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">None</span>
</code></pre></div></div>

<ul>
  <li>Notice these are both in the <code>option</code> type .. either you have <code>Some</code> data or you have <code>None</code>.</li>
  <li><code>option</code> is similar to how you can have null or non-null objects in other languages, but it is explicit here.</li>
  <li>These kinds of types with the capital-letter-named tags are called <strong>variants</strong> in OCaml; each tag wraps a different variant.</li>
  <li>The <code>option</code> type is very useful; here is an oversimplified example.</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">let</span> <span class="n">nice_div</span> <span class="n">m</span> <span class="n">n</span> <span class="o">=</span> <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nc">None</span> <span class="k">else</span> <span class="nc">Some</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">n</span><span class="p">);;</span>
<span class="k">val</span> <span class="n">nice_div</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="n">option</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">fun</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="n">nice_div</span> <span class="mi">10</span> <span class="mi">0</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">None</span>
<span class="o">#</span> <span class="n">nice_div</span> <span class="mi">10</span> <span class="mi">2</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="mi">5</span>
</code></pre></div></div>

<p>There is a downside with this though, you can’t just use <code>nice_div</code> like <code>/</code>:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="p">(</span><span class="n">nice_div</span> <span class="mi">5</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;;</span>
<span class="nc">Line</span> <span class="mi">1</span><span class="o">,</span> <span class="n">characters</span> <span class="mi">0</span><span class="o">-</span><span class="mi">14</span><span class="o">:</span>
<span class="nc">Error</span><span class="o">:</span> <span class="nc">This</span> <span class="n">expression</span> <span class="n">has</span> <span class="k">type</span> <span class="kt">int</span> <span class="n">option</span>
       <span class="n">but</span> <span class="n">an</span> <span class="n">expression</span> <span class="n">was</span> <span class="n">expected</span> <span class="k">of</span> <span class="k">type</span> <span class="kt">int</span>
</code></pre></div></div>

<ul>
  <li>Notice the type of the return value of <code>nice_div</code>, it is <code>int option</code>, not <code>int</code></li>
  <li>This type error is saying the <code>+</code> lhs needs to be type <code>int</code> but is a <code>Some</code> value which is not an <code>int</code>.</li>
</ul>

<p>Here is a non-solution to that:</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">let</span> <span class="n">not_nice_div</span> <span class="n">m</span> <span class="n">n</span> <span class="o">=</span> <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nc">None</span> <span class="k">else</span> <span class="n">m</span> <span class="o">/</span> <span class="n">n</span><span class="p">;;</span>
<span class="nc">Line</span> <span class="mi">1</span><span class="o">,</span> <span class="n">characters</span> <span class="mi">47</span><span class="o">-</span><span class="mi">52</span><span class="o">:</span>
<span class="nc">Error</span><span class="o">:</span> <span class="nc">This</span> <span class="n">expression</span> <span class="n">has</span> <span class="k">type</span> <span class="kt">int</span> <span class="n">but</span> <span class="n">an</span> <span class="n">expression</span> <span class="n">was</span> <span class="n">expected</span> <span class="k">of</span> <span class="k">type</span>
         <span class="k">'</span><span class="n">a</span> <span class="n">option</span>
</code></pre></div></div>
<ul>
  <li>The <code>then</code> and <code>else</code> branches must return the same type, here they do not.</li>
  <li>The <code>int</code> and <code>int option</code> types have no overlap of members!  Generally true across OCaml.</li>
  <li><code>null</code> or similar value can sneak in to a type in other languages, but no such sneaking in OCaml.</li>
  <li>It can make a little more code sometimes but it is more exact/rigorous/debuggable
    <h4 id="using-pattern-matching-to-use-nice_div">Using pattern matching to use <code>nice_div</code></h4>
  </li>
</ul>

<p>Here is how we can in fact use <code>nice_div</code>:</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">match</span> <span class="p">(</span><span class="n">nice_div</span> <span class="mi">5</span> <span class="mi">2</span><span class="p">)</span> <span class="k">with</span> 
   <span class="o">|</span> <span class="nc">Some</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">7</span> <span class="c">(* the nice_div result is (Some 2) and i is bound to the 2 by this pattern *)</span>
   <span class="o">|</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">"This should never happen, we divided by 2"</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">9</span>
</code></pre></div></div>
<ul>
  <li>This shows how OCaml lets us <em>destruct</em> option values, via the <code>match</code> syntax.</li>
  <li><code>match</code> is similar to <code>switch</code> in C/Java/.. but is much more flexible in OCaml</li>
  <li>The LHS in OCaml can be a general pattern which binds variables (the <code>i</code> here), etc</li>
  <li>Note that we turned <code>None</code> into a runtime exception via <code>failwith</code>.</li>
</ul>

<h4 id="result">Result</h4>

<p>A very similar approach to the above is to use the <code>result</code> type, which like <code>option</code> but is specialized for error handling.</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">let</span> <span class="n">nicer_div</span> <span class="n">m</span> <span class="n">n</span> <span class="o">=</span> <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nc">Error</span> <span class="s2">"Divide by zero"</span> <span class="k">else</span> <span class="nc">Ok</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">n</span><span class="p">);;</span>
<span class="k">val</span> <span class="n">nicer_div</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">int</span><span class="o">,</span> <span class="kt">string</span><span class="p">)</span> <span class="n">result</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">fun</span><span class="o">&gt;</span>
</code></pre></div></div>
<ul>
  <li>The <code>result</code> type is explicitly intended for this case of failure-result
    <ul>
      <li><code>Ok</code> means the normal result</li>
      <li><code>Error</code> is the error case, which unlike <code>None</code> can include failure data, usually a string.</li>
    </ul>
  </li>
  <li>Again we can do the same kind of pattern match on <code>Ok/Error</code> as above.</li>
  <li>This is a “more well-typed” version of the C approach of returning <code>-1</code> or <code>NULL</code> to indicate failure.</li>
  <li>The <code>Core</code> libraries use both <code>result</code> and <code>option</code> for error cases</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">match</span> <span class="p">(</span><span class="n">nicer_div</span> <span class="mi">5</span> <span class="mi">2</span><span class="p">)</span> <span class="k">with</span> 
   <span class="o">|</span> <span class="nc">Ok</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">7</span>
   <span class="o">|</span> <span class="nc">Error</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="n">s</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">9</span>
</code></pre></div></div>

<p>Lastly, the function could itself raise an exception in OCaml:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">div_exn</span> <span class="n">m</span> <span class="n">n</span> <span class="o">=</span> <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">failwith</span> <span class="s2">"divide by zero is bad!"</span> <span class="k">else</span> <span class="n">m</span> <span class="o">/</span> <span class="n">n</span><span class="p">;;</span>
<span class="n">div_exn</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">;;</span>
</code></pre></div></div>

<ul>
  <li>This has the property of not needing a match on the result.</li>
  <li>Note that the built-in <code>/</code> also raises an exception.</li>
  <li>Exceptions are side effects though, we want to minimize their usage to avoid error-at-a-distance.</li>
  <li>The above examples show how exceptional conditions can either be handled via exceptions or in the return value;
    <ul>
      <li>A key dimension of this course is this side effect vs direct passing trade-off</li>
      <li>Many bugs, security leaks, etc are due to ignorance of side effects; the <code>Error/Ok</code> approach keeps them “in your face” as a programmer</li>
      <li>Also recall <code>Error/Ok</code> keeps us completely in math-land, the return result tells everything.</li>
    </ul>
  </li>
</ul>

<h3 id="lists">Lists</h3>

<ul>
  <li>Finally we can use a real data structure to write some real programs!</li>
  <li>Lists are the most common data structure in OCaml, similar to dictionaries/objects for Python/JavaScript.</li>
  <li>They are <strong>immutable</strong> so while they look something like arrays or vectors they are <strong>not</strong></li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">3</span><span class="p">];;</span>
<span class="k">let</span> <span class="n">l2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">];;</span>
<span class="k">let</span> <span class="n">l3</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">;</span> <span class="s2">"b"</span><span class="p">;</span> <span class="s2">"c"</span><span class="p">];;</span>
<span class="k">let</span> <span class="n">l4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="s2">"a"</span><span class="p">];;</span> <span class="c">(* error - All elements must have same type *)</span>
<span class="k">let</span> <span class="n">l5</span> <span class="o">=</span> <span class="bp">[]</span><span class="p">;;</span> <span class="c">(* empty list *)</span>
</code></pre></div></div>

<h4 id="building-lists">Building lists</h4>

<p>Lists are represented internally as <strong>binary trees</strong> with left child a leaf.</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">0</span> <span class="o">::</span> <span class="n">l1</span><span class="p">;;</span> <span class="c">(* "::" is 'consing' 0 to the top of the tree - fast *)</span>
<span class="mi">0</span> <span class="o">::</span> <span class="p">(</span><span class="mi">1</span> <span class="o">::</span> <span class="p">(</span><span class="mi">2</span> <span class="o">::</span> <span class="p">(</span><span class="mi">3</span> <span class="o">::</span> <span class="bp">[]</span><span class="p">)));;</span> <span class="c">(* equivalent to [0;1;2;3] *)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="p">[</span><span class="mi">4</span><span class="p">;</span> <span class="mi">5</span><span class="p">];;</span> <span class="c">(* appending lists - slower, needs to cons 3/2/1 on front of [4;5] *)</span>
<span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">;</span> <span class="mi">4</span><span class="p">;</span> <span class="mi">6</span><span class="p">];;</span>
<span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">::</span> <span class="n">z</span><span class="p">;;</span> <span class="c">(* in y, 0 is the *head* (first elt) of the list and z is the *tail* (rest of list) *)</span>
<span class="n">z</span><span class="p">;;</span> <span class="c">(* Observe z itself did not change -- recall lists are immutable in OCaml *)</span>
</code></pre></div></div>

<h4 id="destructing-lists-with-pattern-matching">Destructing Lists with pattern matching</h4>

<ul>
  <li>Before writing real programs here is a simple example of pattern matching on a list.</li>
  <li>This function gets the tail, the list without the first element.</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">tl_exn</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
  <span class="o">|</span>  <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">invalid_arg</span> <span class="s2">"empty lists have no tail"</span>
  <span class="o">|</span>  <span class="n">x</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">xs</span>  <span class="c">(* the pattern x :: xs  binds x to the first elt, xs to ALL the others *)</span>
<span class="p">;;</span>
<span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="p">];;</span> 
<span class="k">let</span> <span class="n">l'</span> <span class="o">=</span> <span class="n">tl_exn</span> <span class="n">l</span><span class="p">;;</span>
<span class="n">l</span><span class="p">;;</span> <span class="c">(* Note: lists are immutable, l didn't change!! *)</span>
<span class="k">let</span> <span class="n">l''</span> <span class="o">=</span>  <span class="n">tl_exn</span> <span class="n">l'</span> <span class="c">(* So to get tail of tail, take tail of l' not 2 x tail of l!  THREAD the state! *)</span>
<span class="n">tl_exn</span> <span class="bp">[]</span><span class="p">;;</span> <span class="c">(* Raises an `invalid_arg` exception if the list had no tail *)</span>
</code></pre></div></div>

<ul>
  <li>An alternative to avoid the exception effect is to return <code>Ok/Error</code>:</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">tl</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
  <span class="o">|</span>  <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="nc">Error</span> <span class="s2">"empty list has no tail"</span>
  <span class="o">|</span>  <span class="n">x</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="nc">Ok</span> <span class="n">xs</span>
<span class="p">;;</span>
<span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="p">];;</span> 
<span class="k">let</span> <span class="n">l'</span> <span class="o">=</span> <span class="n">tl</span> <span class="n">l</span><span class="p">;;</span>
<span class="n">tl</span> <span class="bp">[]</span><span class="p">;;</span>
<span class="k">let</span> <span class="n">l''</span> <span class="o">=</span> <span class="n">tl</span> <span class="n">l'</span> <span class="c">(* Oops this fails!  As in the div example above need to case on `Ok/Error` *)</span>
</code></pre></div></div>

<ul>
  <li>Lists are not random access like arrays; if you want to get the nth element, you need to work for it.</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="k">rec</span> <span class="n">nth_exn</span> <span class="n">l</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
  <span class="o">|</span>  <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">invalid_arg</span> <span class="s2">"there is no nth element in this list"</span>
  <span class="o">|</span>  <span class="n">x</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">x</span> <span class="k">else</span> <span class="n">nth_exn</span> <span class="n">xs</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">;;</span>
<span class="n">nth_exn</span> <span class="p">[</span><span class="mi">33</span><span class="p">;</span><span class="mi">22</span><span class="p">;</span><span class="mi">11</span><span class="p">]</span> <span class="mi">1</span><span class="p">;;</span>
<span class="n">nth_exn</span> <span class="p">[</span><span class="mi">33</span><span class="p">;</span><span class="mi">22</span><span class="p">;</span><span class="mi">11</span><span class="p">]</span> <span class="mi">3</span><span class="p">;;</span>
</code></pre></div></div>

<p>Fortunately many common operations are already in the <code>List</code> module in the <code>Core</code> library:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="nn">List</span><span class="p">.</span><span class="n">nth</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="p">]</span> <span class="mi">2</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="mi">3</span>
</code></pre></div></div>
<ul>
  <li>This library uses the <code>option</code> type instead of raising an exception like we did</li>
  <li><code>List.nth_exn</code> raises an exception like ours does.  Both versions are useful.
    <ul>
      <li>Note this function is also <code>Core.List.nth_exn</code> but we always <code>open Core;;</code> to make <code>Core</code> module functions implicitly available</li>
    </ul>
  </li>
  <li>On Assignment 1 you <strong>cannot</strong> use <code>List.</code> libraries, you first need to practice using <code>let rec</code>
    <ul>
      <li>On Assignment 2 you will start using the <code>List.</code> libraries.</li>
    </ul>
  </li>
</ul>

      
          </section>
        </div>
      </div>

				<div id="copyright">
					Web Design: TEMPLATED
				</div>			


   </body>
</html>
