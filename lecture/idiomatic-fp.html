<!DOCTYPE HTML>
<!--
Solarize by TEMPLATED
templated.co @templatedco
Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
<head>
 <title>Functional Programming and Software Engineering</title>
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <meta name="description" content="" />
 <meta name="keywords" content="" />
 <!--[if lte IE 8]><script src="/pl/css/ie/html5shiv.js"></script><![endif]-->
 <script src="/fpse/js/jquery.min.js"></script>
 <script src="/fpse/js/jquery.dropotron.min.js"></script>
 <script src="/fpse/js/skel.min.js"></script>
 <script src="/fpse/js/skel-layers.min.js"></script>
 <script src="/fpse/js/init.js"></script>
 <noscript>
  <link rel="stylesheet" href="/fpse/css/skel.css" />
  <link rel="stylesheet" href="/fpse/css/style.css" />
 </noscript>
 <!--[if lte IE 8]><link rel="stylesheet" href="/fpse/css/ie/v8.css" /><![endif]-->
</head>
<body>

 <!-- Header Wrapper -->
  <div class="wrapper style1">
  
  <!-- Header -->
   <div id="header">
    <div class="container">
      
     <!-- Logo -->
      <h1><a href="/fpse/index.html" id="logo">FPSE</a></h1>
     
     <!-- Nav -->
      <nav id="nav">
       <ul>
          <li><a href="/fpse/logistics.html">Logistics</a></li>
          <li><a href="/fpse/dateline.html">Dateline</a></li> <!-- converted; don't edit .html edit .md -->
          <li><a href="/fpse/coding.html">Coding</a>
            <li><a href="">Assignments</a>
                <ul class="menu">
                <li><a href="/fpse/assignments/assignment1.html">Assignment 1</a></li>
                <li><a href="/fpse/assignments/assignment2.html">Assignment 2</a></li>
                <li><a href="/fpse/assignments/assignment3.html">Assignment 3</a></li>
                <li><a href="/fpse/assignments/assignment4.html">Assignment 4</a></li>
                <li><a href="/fpse/assignments/assignment5.html">Assignment 5</a></li>
                <li><a href="/fpse/assignments/assignment6.html">Assignment 6</a></li>
                <li><a href="/fpse/assignments/assignment7.html">Assignment 7</a></li>
                <li><a href="/fpse/assignments/project.html">Project</a></li>
              </ul></li>          <li><a href="https://courselore.org/courses/1192943254">Q&A</a></li>
          <li><a href="/fpse/contact.html">Contact Us</a></li>
      </ul>
</nav>
</div>
</div>


<!-- close-out code before the standard footer .. use to glue in raw html. -->
</div>
<!-- Main -->
<div id="main" class="wrapper style4">
<!-- Content -->
<div id="content" class="container">
<section>

<link rel="stylesheet" href="/fpse/css/friendly.css" />
<meta charset="utf-8" />
    
<h2 id="idiomatic-functional-programming">Idiomatic Functional Programming</h2>

<ul>
  <li>Design principles, design patterns, refactoring in Object-Oriented programming<br />
           = <br />
<strong>Principles &amp; idioms</strong> in Functional Programming</li>
  <li><strong>Principles</strong>: overarching principles; <strong>Idioms</strong>: more focused ideas to aid in achieving principles</li>
  <li>We have touched on much of this so much of this is review</li>
</ul>

<h3 id="fp-principles">FP Principles</h3>

<ol>
  <li>“Concise is nice”
    <ul>
      <li>Goal of making code as short as possible</li>
      <li>From the classic Strunk and White English writing guide:
        <blockquote>
          <p>A sentence should contain no unnecessary words, a paragraph no unnecessary sentences, for the same reason that a drawing should have no unnecessary lines and a machine no unnecessary parts</p>
        </blockquote>
      </li>
      <li>Concise code means that more information will fit in your brain’s fixed-size working set</li>
    </ul>
  </li>
  <li>Modularity / focus of responsibility
    <ul>
      <li>Make clear divisions of responsibility between different modules and functions</li>
      <li>Attempt to make this factoring of responsibilities the most elegant which will aid in theme 1. above.</li>
    </ul>
  </li>
  <li>Generally avoid side effects; it will help you achieve 1. and 2.
    <ul>
      <li>Recall how pure functional code is referentially transparent, the behavior is all in the interface with no “hidden” actions.</li>
      <li>Side effect world view is a state machine vs functional view as a pipeline explicitly passing data on</li>
      <li>Occasionally side effects will make code more concise, that is when to use them</li>
    </ul>
  </li>
  <li>Speed
    <ul>
      <li>There is always a trade-off in programming between efficiency and elegance</li>
      <li>Much of the time it is possible to prioritize concision and modularity over running time and space</li>
    </ul>
    <ul>
      <li>Note that Python and JavaScript are ~5-10 times slower than C or OCaml, a case in point for speed not a priority<br />
    - <strong>But</strong>, sometimes speed really matters</li>
      <li>When data sets get large or algorithms get complex</li>
      <li>Do generally avoid high polynomial or exponential algorithms on potentially large inputs</li>
      <li>Also pay more attention when data sets get extremely large, even n vs n log n gets noticeable there.</li>
      <li>We won’t cover performance any more today but there is a <a href="efficiency.html">whole lecture</a> coming up on the topic.</li>
    </ul>
  </li>
</ol>

<h3 id="fp-idioms">FP Idioms</h3>

<p>Here is a list of idioms, many of which are review as we touched on them before</p>

<h4 id="dont-repeat-yourself-dry-from-oo">Don’t Repeat Yourself (DRY from OO):</h4>
<ul>
  <li>Extract duplicate code into its own function</li>
  <li>if there is common code except for one spot, make that spot a code (i.e.function) parameter
    <ul>
      <li>example: make a map function on a tree if you are doing many tree operations that are maps.</li>
    </ul>
  </li>
  <li>Code usually won’t be exact duplicate; extract different bits as function parameters so the different bits are passed in</li>
  <li>May also entail replacing specific types with generic types <code>'a</code> or functor parameter types <code>t</code>, <code>elt</code> etc</li>
</ul>

<h4 id="hide-it-behind-an-interface">Hide it behind an interface</h4>
<ul>
  <li>Hiding minimizes what programmer-users have to think about, they can think at the higher (simpler) level of the interface
    <ul>
      <li>and, this again will take up less brain space since they are not seeing lots of low-level details.</li>
    </ul>
  </li>
  <li>If a function is auxiliary to only one other function, define it in the body of the latter.
    <ul>
      <li>i.e. <code>let f x = let aux y = ..&lt;aux's body&gt;.. in .. &lt;f's body&gt; ..</code></li>
    </ul>
  </li>
  <li>If a function is not local to a single function but is not used outside its module, leave it out of the module type (the <code>.mli</code> file) which will hide it to module users</li>
  <li>Make a new module for a new data type, and include operations on the type (only) in it
    <ul>
      <li>This is not just for generic data structures like <code>Map</code>/<code>Set</code>, it is for app-specific data structures</li>
      <li>Example: <code>ChessBoard</code> is a nontrivial data type for a chess game, make it its own module</li>
    </ul>
  </li>
  <li>Hide types <code>t</code> in module types if users don’t need to see the details</li>
  <li>Functional code has everything in the interface so it will make a more accurate interface
    <ul>
      <li>This is not always good though: consider e.g. imperative <code>fresh_name : () -&gt; string</code> making a different string each time called
        <div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">fresh_name</span> <span class="bp">()</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter</span> <span class="o">:=</span> <span class="o">!</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="s2">"name"</span><span class="o">^</span><span class="p">(</span><span class="nn">Int</span><span class="p">.</span><span class="n">to_string</span> <span class="o">!</span><span class="n">counter</span><span class="p">)</span>
</code></pre></div>        </div>
      </li>
      <li>To make a fresh string in functional code you would need to e.g. pass the previous count and return the next one.
        <div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">fresh_name</span> <span class="p">(</span><span class="n">previous</span> <span class="o">:</span> <span class="kt">int</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="kt">string</span> <span class="o">*</span> <span class="kt">int</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"name"</span><span class="o">^</span><span class="p">(</span><span class="nn">Int</span><span class="p">.</span><span class="n">to_string</span> <span class="n">previous</span><span class="p">)</span><span class="o">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">let</span> <span class="p">(</span><span class="n">name1</span><span class="o">,</span><span class="n">count1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fresh_name</span> <span class="mi">0</span> <span class="k">in</span>
<span class="k">let</span> <span class="p">(</span><span class="n">name1</span><span class="o">,</span><span class="n">count2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fresh_name</span> <span class="n">count1</span> <span class="k">in</span> <span class="o">...</span>
</code></pre></div>        </div>
        <p>This is a more accurate interface to what freshness needs, but any function needing to make fresh names would need to be passed and return the current <code>count</code> value.  Yuck!</p>
      </li>
      <li>The difficulty for long-time imperative programmers is everything looks like a <code>fresh_name</code> case at first, it just seems impossible to write an elegant functional version.  Don’t give up, you will learn!</li>
    </ul>
  </li>
</ul>

<h4 id="have-a-focus-of-responsibility">Have a focus of responsibility</h4>
<ul>
  <li>Each function and module should have a clear focus that can be summarized in a sentence</li>
  <li>Divide one function/module into two if it is doing two different things</li>
  <li>Don’t add random stuff to a module if it doesn’t fit with it’s summary purpose</li>
  <li>If you need more than is in an existing module, make a new one and <code>include</code> the old one</li>
</ul>

<h4 id="concision">Concision</h4>

<p>Many particular low-level points were already covered in the <a href="../style-guide.md">FPSE Style Guide</a>, here is a review:</p>

<ul>
  <li><strong>Combinize</strong>: replace <code>let rec</code> with <code>map</code>s, <code>fold</code>s and the like
    <ul>
      <li>and, for your own data structures write your own combinators and then use in place of <code>rec</code></li>
    </ul>
  </li>
  <li>Use advanced pattern matching (<code>as</code>, <code>with</code>, deep patterns, partial record patterns, <code>_</code>, etc)</li>
  <li>Use <code>|&gt;</code> in place of call sequences, and make your functions amenable to piping
    <ul>
      <li>To have pipes be effective, the best way is to follow <code>Core</code> and name the parameters that are not the underlying data you will often want to pipe on. For example <code>List.filter : 'a list -&gt; f:('a -&gt; bool) -&gt; 'a list</code> and since <code>f</code> named can apply it first to make an <code>'a list -&gt; 'a list</code> function ripe for piping:
        <div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">[</span><span class="mi">2</span><span class="p">;</span><span class="mi">5</span><span class="p">;</span><span class="o">-</span><span class="mi">6</span><span class="p">;</span><span class="mi">22</span><span class="p">]</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">~</span><span class="n">f</span><span class="o">:</span><span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">is_empty</span> <span class="o">|&gt;</span> <span class="n">not</span><span class="p">;;</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Use <code>@@</code> in place of parentheses</li>
  <li>Inline simple <code>let</code> definitions to make code read as a concise sentence
    <ul>
      <li>Also a small function called only once or twice may read better inlined</li>
      <li>Conversely, make more <code>let</code> definitions if the code is too convoluted</li>
    </ul>
  </li>
</ul>

<p>Functional code is not always more concise than stateful code, but it is surprisingly good</p>
<ul>
  <li>Let us revisit the <a href="https://pl.cs.jhu.edu/fpse/examples/random-examples/matching.ml">parenthesis matching</a> example from the previous lecture on side effects.</li>
  <li>At the end of this file is a purely functional version of paren matching; the code is much more concise.</li>
</ul>

<h3 id="examples-of-idiomatic-fp">Examples of Idiomatic FP</h3>
<p><a name="examples"></a></p>
<ul>
  <li>
    <p>Here are example codebases we will spend some time inspecting and critiqueing.</p>

    <ul>
      <li><a href="https://exercism.io/tracks/ocaml/exercises/minesweeper">Minesweeper</a> at Exercism.io
        <ul>
          <li><a href="https://exercism.io/tracks/ocaml/exercises/minesweeper/solutions/ace26e2f446a4a18a3b1bad83dd9487c">This functional implementation</a> shows several nice OCaml patterns. <a href="../examples/minesweeper/src/minesweeper.ml">Here</a> is the version we reviewed in class which has several variations on the original implementation.</li>
          <li>We made a <a href="../examples/minesweeper/src/mine_array.ml">variation on the functional version</a> to be cleaner and more efficient</li>
          <li>Will look at an <a href="../examples/minesweeper/src/mine_mutate.ml">imperative approach</a> which has some really poor abstractions and fails to use combinators.</li>
        </ul>
      </li>
      <li><a href="https://github.com/marcoonroad/ocaml-cuid">ocaml-cuid</a> is a utility to generate highly random string IDs for webpages etc.
        <ul>
          <li>Lots of nice piping here plus use of functors to build Unix and JavaScript variations</li>
        </ul>
      </li>
      <li><a href="https://github.com/UnixJunkie/dolog">dolog</a> is a very simple logging utility
        <ul>
          <li>Shows some nice use of state, <code>include</code>, and a <code>Make</code> functor.</li>
        </ul>
      </li>
      <li>We may also look at a past homework solution so you can compare it with what you did.</li>
    </ul>
  </li>
</ul>
      
          </section>
        </div>
      </div>

				<div id="copyright">
					Web Design: TEMPLATED
				</div>			


   </body>
</html>
