<!DOCTYPE HTML>
<!--
Solarize by TEMPLATED
templated.co @templatedco
Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
<head>
 <title>Functional Programming and Software Engineering</title>
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <meta name="description" content="" />
 <meta name="keywords" content="" />
 <!--[if lte IE 8]><script src="/pl/css/ie/html5shiv.js"></script><![endif]-->
 <script src="/fpse/js/jquery.min.js"></script>
 <script src="/fpse/js/jquery.dropotron.min.js"></script>
 <script src="/fpse/js/skel.min.js"></script>
 <script src="/fpse/js/skel-layers.min.js"></script>
 <script src="/fpse/js/init.js"></script>
 <noscript>
  <link rel="stylesheet" href="/fpse/css/skel.css" />
  <link rel="stylesheet" href="/fpse/css/style.css" />
 </noscript>
 <!--[if lte IE 8]><link rel="stylesheet" href="/fpse/css/ie/v8.css" /><![endif]-->
</head>
<body>

 <!-- Header Wrapper -->
  <div class="wrapper style1">
  
  <!-- Header -->
   <div id="header">
    <div class="container">
      
     <!-- Logo -->
      <h1><a href="/fpse/index.html" id="logo">FPSE</a></h1>
     
     <!-- Nav -->
      <nav id="nav">
       <ul>
          <li><a href="/fpse/logistics.html">Logistics</a></li>
          <li><a href="/fpse/dateline.html">Dateline</a></li> <!-- converted; don't edit .html edit .md -->
          <li><a href="/fpse/coding.html">Coding</a>
            <li><a href="">Assignments</a>
                <ul class="menu">
                <li><a href="/fpse/assignments/assignment1.html">Assignment 1</a></li>
                <li><a href="/fpse/assignments/assignment2.html">Assignment 2</a></li>
                <li><a href="/fpse/assignments/assignment3.html">Assignment 3</a></li>
                <li><a href="/fpse/assignments/assignment4.html">Assignment 4</a></li>
                <li><a href="/fpse/assignments/assignment5.html">Assignment 5</a></li>
                <li><a href="/fpse/assignments/assignment6.html">Assignment 6</a></li>
                <li><a href="/fpse/assignments/assignment7.html">Assignment 7</a></li>
                <li><a href="/fpse/assignments/project.html">Project</a></li>
              </ul></li>          <li><a href="https://courselore.org/courses/1192943254">Q&A</a></li>
          <li><a href="/fpse/contact.html">Contact Us</a></li>
      </ul>
</nav>
</div>
</div>


<!-- close-out code before the standard footer .. use to glue in raw html. -->
</div>
<!-- Main -->
<div id="main" class="wrapper style4">
<!-- Content -->
<div id="content" class="container">
<section>

<link rel="stylesheet" href="/fpse/css/friendly.css" />
<meta charset="utf-8" />
    <h1 id="modules-basics">Modules Basics</h1>

<p>We’ve been using modules without thinking too much about them: <code>List.map</code>, <code>Float.(2 = 3)</code>, <code>Fn.id</code> – these are uses of modules <code>List</code>, <code>Float</code>, and <code>Fn</code> that are in the <code>Core</code> library.</p>

<p>Now we will look at how to define our own modules to make our own libraries and code components.</p>

<h2 id="what-is-a-module">What is a module?</h2>

<p>A module is a collection of OCaml definitions:</p>
<ul>
  <li><code>let</code>-defined entities, i.e. functions and values</li>
  <li>types</li>
  <li>
    <p>other modules</p>
  </li>
  <li>Modules are something like records, but they can also hold e.g. types which makes them much more powerful.</li>
  <li>But, modules are not first class values like records – for example, they can’t directly be passed as arguments to functions.</li>
</ul>

<h2 id="ml-files-are-modules"><code>.ml</code> files are modules</h2>

<p>OCaml has a simple rule:</p>
<ul>
  <li>The contents of a file <code>foo.ml</code> define the module <code>Foo</code>.</li>
  <li>Capitalize the first letter (only) and drop the <code>.ml</code> to turn a file name into its module name.</li>
</ul>

<p>In this lecture, we’ll work with a running example. See <a href="../examples/set-example.zip">set-example.zip</a> for the full code.</p>

<p>Here is <code>string_set.ml</code> from that example:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">open</span> <span class="nc">Core</span>

<span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">string</span> <span class="kt">list</span> <span class="c">(* This is a *type abreviation*: a string set is a list of strings *)</span>

<span class="k">let</span> <span class="n">empty</span> <span class="o">:</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">[]</span> <span class="c">(* the one canonical empty set *)</span>

<span class="k">let</span> <span class="n">add</span> <span class="p">(</span><span class="n">x</span> <span class="o">:</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">x</span> <span class="o">::</span> <span class="n">s</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">remove</span> <span class="p">(</span><span class="n">x</span> <span class="o">:</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="n">t</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">s</span> <span class="k">with</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">"item is not in set"</span>
  <span class="o">|</span> <span class="n">hd</span> <span class="o">::</span> <span class="n">tl</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nn">String</span><span class="p">.</span><span class="n">equal</span> <span class="n">hd</span> <span class="n">x</span>
    <span class="k">then</span> <span class="n">tl</span> <span class="c">(* we don't remove from the tail: this is actually a multiset *)</span>
    <span class="k">else</span> <span class="n">hd</span> <span class="o">::</span> <span class="n">remove</span> <span class="n">x</span> <span class="n">tl</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">contains</span> <span class="p">(</span><span class="n">x</span> <span class="o">:</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">s</span> <span class="k">with</span>
  <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="bp">false</span>
  <span class="o">|</span> <span class="n">hd</span> <span class="o">::</span> <span class="n">tl</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nn">String</span><span class="p">.</span><span class="n">equal</span> <span class="n">x</span> <span class="n">hd</span> 
    <span class="k">then</span> <span class="bp">true</span> 
    <span class="k">else</span> <span class="n">contains</span> <span class="n">x</span> <span class="n">tl</span>
</code></pre></div></div>

<h3 id="loading-a-module-into-utop">Loading a module into <code>utop</code></h3>

<p>Use <code>dune utop</code> to fire up the OCaml toploop with the module loaded.</p>
<ul>
  <li>Then access the module’s contents in <code>String_set</code>.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dune utop
</code></pre></div></div>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">add</span> <span class="s2">"hello"</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">empty</span> <span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"hello"</span><span class="p">]</span>
</code></pre></div></div>

<p>Or open the module with <code>open String_set</code> to put everything from inside it into scope:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">open</span> <span class="nc">String_set</span> <span class="p">;;</span>
<span class="o">#</span> <span class="n">add</span> <span class="s2">"hello"</span> <span class="n">empty</span> <span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"hello"</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Here, the fact that we used a <code>list</code> to implement the set is exposed to library users.</li>
  <li>Naming the type <code>t</code> is standard for “the” underlying type in a module (if there is one).
    <ul>
      <li>Built-in libraries also use this: for example, <code>Int.t</code> is an alias for <code>int</code>, etc.</li>
    </ul>
  </li>
  <li>Then, <code>String_set.t</code> is read as “string set’s underlying type`.</li>
</ul>

<h2 id="hiding-details-with-module-types">Hiding details with module types</h2>

<p>Modules have <em>types</em>, called <strong>module types</strong> or <strong>signatures</strong>.</p>
<ul>
  <li>The latter term is used in math, e.g. “a DFA has signature D = (S, Σ, τ, s0, F)”</li>
  <li>In a signature all the types of entities in the module are declared</li>
  <li>And, types declared in a module are repeated in the signature again (a bit odd, but for a reason)</li>
  <li>Module types are also placed in files, just put an <code>i</code> on the end
    <ul>
      <li>So for example the module type of <code>String_set</code> is in the <code>string_set.mli</code> file.</li>
    </ul>
  </li>
  <li>Here are the contents of that file:</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">string</span> <span class="kt">list</span> <span class="c">(* Type declarations are by default copied from .ml to .mli file *)</span>
<span class="c">(* type t (* this alternate version of type t declaration *hides* t's internals *) *)</span>
<span class="k">val</span> <span class="n">empty</span> <span class="o">:</span> <span class="n">t</span>
<span class="k">val</span> <span class="n">add</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span>
<span class="k">val</span> <span class="n">remove</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span>
<span class="k">val</span> <span class="n">contains</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
</code></pre></div></div>

<ul>
  <li>See how we repeat the <code>type t =</code> alias declaration in this <code>.mli</code> file</li>
  <li>But, there is an alterative way to write that declaration: remove <code>= string list</code>
    <ul>
      <li>comment the first line and uncomment the second to get that version</li>
    </ul>
  </li>
  <li>By doing this, the type <code>t</code> has been made <em>abstract</em>: users no longer can see <code>t</code> is a list</li>
</ul>

<p>Now if we save that change and type <code>dune utop</code>:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">add</span> <span class="s2">"hello"</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">empty</span> <span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>The printed value is now <code>&lt;abstr&gt;</code>, not <code>["hello"]</code> like before.</p>
<ul>
  <li>The type is hidden; so are the values.</li>
</ul>

<p>Why do this?</p>
<ul>
  <li>Good:
    <ul>
      <li>Program to interfaces, not implementations.</li>
      <li>We can change the implementation without changing client code.</li>
      <li>The abstraction prevents misuse and maintains invariants.</li>
    </ul>
  </li>
  <li>Bad:
    <ul>
      <li>It’s hard to see what’s going on in <code>utop</code>.</li>
      <li>It can be harder to test our module.</li>
    </ul>
  </li>
</ul>

<p>Further, anything define in the <code>.ml</code> that is not declared in the <code>.mli</code> is not accessible to users.</p>
<ul>
  <li>It’s like those types/values are <code>private</code>.</li>
  <li>If there is nothing to hide, then you don’t need an <code>.mli</code> file at all. The type of the module will be inferred.</li>
  <li>All assignments come with an <code>.mli</code> file so you get used to the format
    <ul>
      <li>Also the documentation specifying what a function does should go in the <code>.mli</code> file by convention</li>
      <li>We have followed that pattern for Assignment 3</li>
    </ul>
  </li>
</ul>

<h2 id="building-modules">Building modules</h2>

<p>Recall that <code>dune</code> files are like <code>Makefile</code>s for OCaml<br />
To make a library module from the <code>string_set.ml</code> file, we include this in the <code>dune</code> file:</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">; in file `src/dune`</span>
<span class="p">(</span><span class="nf">library</span>
 <span class="p">(</span><span class="nf">name</span> <span class="nv">string_set</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">modules</span> <span class="nv">string_set</span><span class="p">)</span> 
 <span class="p">(</span><span class="nf">libraries</span> <span class="nv">core</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="writing-executables">Writing executables</h2>

<p>Let’s make an actual executable program to do something, not just a library.</p>

<ul>
  <li>The file <code>set_main.ml</code> is our example, it takes a string and a file name and looks for that line in the file.</li>
  <li>Executables work by running all statements in the file from top to bottom. Any side effects are the “outputs” of the executable.</li>
  <li>Note that pure functional programs are useless as executables, input and output is a side effect and we need it to write applications.</li>
  <li>Typically, the main work in an executable is put under a <code>let () = ...</code> statement. The <code>...</code> evaluates to <code>() : unit</code>, and the side effects it performs are what we see.</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">(* Just a helper function. Does not run until it's given arguments in `let () = ...` *)</span>
<span class="k">let</span> <span class="n">do_search</span> <span class="n">search_string</span> <span class="n">filename</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">my_set</span> <span class="o">=</span>
    <span class="n">filename</span>
    <span class="o">|&gt;</span> <span class="nn">In_channel</span><span class="p">.</span><span class="n">read_lines</span>
    <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold</span> <span class="o">~</span><span class="n">f</span><span class="o">:</span><span class="p">(</span><span class="k">fun</span> <span class="n">set</span> <span class="n">elt</span> <span class="o">-&gt;</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">add</span> <span class="n">elt</span> <span class="n">set</span><span class="p">)</span> <span class="o">~</span><span class="n">init</span><span class="o">:</span><span class="nn">String_set</span><span class="p">.</span><span class="n">empty</span>
  <span class="k">in</span>
  <span class="k">if</span> <span class="nn">String_set</span><span class="p">.</span><span class="n">contains</span> <span class="n">search_string</span> <span class="n">my_set</span>
  <span class="k">then</span> <span class="n">print_string</span> <span class="o">@@</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="o">^</span> <span class="n">search_string</span> <span class="o">^</span> <span class="s2">"</span><span class="se">\"</span><span class="s2"> found</span><span class="se">\n</span><span class="s2">"</span>
  <span class="k">else</span> <span class="n">print_string</span> <span class="o">@@</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="o">^</span> <span class="n">search_string</span> <span class="o">^</span> <span class="s2">"</span><span class="se">\"</span><span class="s2"> not found</span><span class="se">\n</span><span class="s2">"</span>

<span class="c">(* This statement has some printing side effects that we observe when running the executable *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">match</span> <span class="nn">Array</span><span class="p">.</span><span class="n">to_list</span> <span class="p">(</span><span class="nn">Sys</span><span class="p">.</span><span class="n">get_argv</span> <span class="bp">()</span><span class="p">)</span> <span class="k">with</span>
  <span class="o">|</span> <span class="n">_</span> <span class="o">::</span> <span class="n">search_string</span> <span class="o">::</span> <span class="n">filename</span> <span class="o">::</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="n">do_search</span> <span class="n">search_string</span> <span class="n">filename</span>
  <span class="o">|</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">"Invalid arguments: requires two parameters, search string and file name"</span>
</code></pre></div></div>

<h3 id="building-executables">Building executables</h3>

<p>To build our executable, the <code>dune</code> file has a stanza for an <code>executable</code>:</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">; in file `src/dune`</span>
<span class="p">(</span><span class="nf">executable</span>
  <span class="p">(</span><span class="nf">name</span> <span class="nv">set_main</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">modules</span> <span class="nv">set_main</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">libraries</span> <span class="nv">string_set</span> <span class="nv">core</span><span class="p">)</span> <span class="c1">; uses Core and the String_set module we made</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This makes an executable out of the <code>set_main.ml</code> file.</p>

<h3 id="running-executables">Running executables</h3>

<ul>
  <li>If you declared an executable in <code>dune</code> as above, it will make a file <code>set_main.exe</code></li>
  <li>To run it, you can do <code>dune exec -- ./src/set_main.exe "open Core" src/string_set.ml</code></li>
  <li>Which is really just <code>_build/default/src/set_main.exe "open Core" src/string_set.ml</code> after building</li>
</ul>

<h3 id="aside-the-stdioin_channel-library-used-in-this-executable">Aside: the <code>Stdio.In_channel</code> library used in this executable</h3>

<ul>
  <li><code>set_main.ml</code> uses the <code>In_channel</code> module to read in file contents
    <ul>
      <li>(Note that I/O is a <strong>side effect</strong>, I/O functions do things besides the value returned)</li>
    </ul>
  </li>
  <li>It is part of the <code>Stdio</code> module (which is itself included in <code>Core</code> so <code>Core.In_channel</code> is the same as <code>Stdio.In_channel</code>)</li>
  <li>The Documentation is <a href="https://ocaml.org/p/stdio/latest/doc/Stdio/index.html">here</a>; we will go through it to observe a few points
    <ul>
      <li>First, now that we covered abstract types we can see there is an abstract type <code>t</code> here</li>
      <li>As with our own set, it is “the underlying data” for the module, in this case file handles</li>
      <li>It is hidden though so we don’t get access to the details of how “files are handled”</li>
      <li>In Visual Studio hover over a function definition to get the docs</li>
    </ul>
  </li>
</ul>

<h3 id="aside-optional-arguments">Aside: Optional arguments</h3>

<ul>
  <li>One topic we skipped over which is in many of these libraries is <strong>optional arguments</strong></li>
  <li>They are named arguments but you don’t need to give them, indicated by a <code>?</code> before the name.</li>
  <li>If you <em>do</em> give them, they are like named aguments, use <code>~name:</code> syntax</li>
  <li>e.g. in <code>In_channel.read_lines</code>, <code>?fix_win_eol</code> is an optional boolean argument
    <ul>
      <li>To use it just add <code>~fix_win_eol: true</code> (since its optional and we want the default false we left it off)</li>
      <li>If you write a function with an optional argument it will show up to you as an <code>option</code>-typed object: <code>Some</code> (given) or <code>None</code> (not given).</li>
    </ul>
  </li>
  <li>Many languages now support optional arguments</li>
</ul>

<p>Example of writing a function with an optional argument:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">let</span> <span class="n">f</span> <span class="o">?</span><span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="nc">Some</span> <span class="n">z</span> <span class="o">-&gt;</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span> <span class="o">|</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="n">y</span><span class="p">;;</span>
<span class="k">val</span> <span class="n">f</span> <span class="o">:</span> <span class="o">?</span><span class="n">x</span><span class="o">:</span><span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">fun</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="n">f</span> <span class="o">~</span><span class="n">x</span><span class="o">:</span><span class="mi">1</span> <span class="mi">2</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">#</span> <span class="n">f</span> <span class="mi">2</span><span class="p">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre></div></div>

<ul>
  <li>Use them when they are the right thing: will reduce clutter of passing often un-needed items.</li>
</ul>

<h3 id="aside-the-sys-library-in-the-set_mainml-code">Aside: The <code>Sys</code> library in the <code>set_main.ml</code> code</h3>

<ul>
  <li>We are using this library to read in the command line args, via <code>Sys.get_argv</code>.</li>
  <li>The documentation is <a href="https://ocaml.org/p/core/latest/doc/Core/Sys/index.html">here</a>
    <ul>
      <li>Notice how this particular module has no carrier type <code>t</code>, it is just a collection of utility functions.</li>
    </ul>
  </li>
</ul>

<h3 id="aside-modules-within-modules">Aside: Modules within modules</h3>

<ul>
  <li>It is often useful to have modules inside of modules for further code “modularization”</li>
  <li>The way it is declared is in e.g. <code>foo.ml</code> (which itself defines the items for module <code>Foo</code> using the above convention), add
    <div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Sub</span> <span class="o">=</span> <span class="k">struct</span> 
  <span class="k">let</span> <span class="n">blah</span> <span class="o">=</span> <span class="o">...</span>
 <span class="o">...</span>
<span class="k">end</span>
</code></pre></div>    </div>
    <p>where the <code>...</code> are the same kinds of declarations that are in files like <code>foo.ml</code>.</p>
  </li>
  <li>This syntax is also how we can directly define a module in <code>utop</code> without putting it in a file.</li>
  <li>In the remainder of the file you can access the contents of <code>Sub</code> as <code>Sub.blah</code>, and outside of the <code>foo.ml</code> file <code>Foo.Sub.blah</code> will access.</li>
</ul>

<h3 id="aside-referencing-and-disambiguating-types-declared-in-modules">Aside: Referencing and disambiguating types declared in modules</h3>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">A</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">:</span> <span class="kt">int</span> <span class="p">;</span> <span class="n">y</span> <span class="o">:</span> <span class="kt">bool</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">let</span> <span class="n">ra</span> <span class="o">=</span> <span class="nn">A</span><span class="p">.{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">true</span> <span class="p">}</span> <span class="c">(* Need to write `A.` here to make the type `A.t` visible *)</span>

<span class="k">module</span> <span class="nc">B</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span> <span class="n">x</span> <span class="o">:</span> <span class="kt">int</span> <span class="p">;</span> <span class="n">z</span> <span class="o">:</span> <span class="kt">float</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">let</span> <span class="n">rb</span> <span class="o">=</span> <span class="nn">B</span><span class="p">.{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">1</span> <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Recall that <code>open</code> makes the contents of a module directly available.</li>
  <li>Now if <code>A</code> and <code>B</code> are both opened, the most recently opened <code>t</code> will win.</li>
</ul>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">open</span> <span class="nc">A</span>
<span class="k">open</span> <span class="nc">B</span>

<span class="k">let</span> <span class="n">f</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">x</span> <span class="c">(* type inferred for r is B.t, just like with newratio *)</span>

<span class="c">(* A type annotation will disambiguate: *)</span>
<span class="k">let</span> <span class="n">f</span> <span class="p">(</span><span class="n">r</span> <span class="o">:</span> <span class="nn">A</span><span class="p">.</span><span class="n">t</span><span class="p">)</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">x</span>
</code></pre></div></div>

<h3 id="aside-deriving-in-modules">Aside: @@deriving in modules</h3>

<p><code>@@deriving</code> names things slightly differently when used in a module.</p>

<p>Suppose we made a module out of our previous nucleotide example, either by putting in a file <code>nucleotide.ml</code> or adding <code>module Nucleotide = struct .. end</code> to make a top-loop or nested module:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Nucleotide</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">A</span> <span class="o">|</span> <span class="nc">C</span> <span class="o">|</span> <span class="nc">G</span> <span class="o">|</span> <span class="nc">T</span> <span class="p">[</span><span class="o">@@</span><span class="n">deriving</span> <span class="n">equal</span><span class="p">]</span>

  <span class="k">let</span> <span class="n">hamming_distance</span> <span class="n">l</span> <span class="o">=</span> <span class="n">failwith</span> <span class="s2">"dummy"</span>
<span class="k">end</span>
</code></pre></div></div>
<ul>
  <li>When this type was called <code>nucleotide</code> not in a module the <code>ppx</code> made a function <code>equal_nucleotide</code></li>
  <li>Here the <code>ppx</code> is smarter, instead of <code>Nucleotide.equal_t</code> it just makes <code>Nucleotide.equal</code> - <code>t</code> is a special type in the module</li>
  <li>Note that <code>[@@deriving ..]</code> declarations in types in the <code>.ml</code> file need to be repeated in the <code>.mli</code> file if the types are not hidden</li>
</ul>
      
          </section>
        </div>
      </div>

				<div id="copyright">
					Web Design: TEMPLATED
				</div>			


   </body>
</html>
